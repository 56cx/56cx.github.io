<!doctype html><html lang="zh" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="📃文章案例实践及剖析：《高德信息业务DDD实战 - 聊聊用领域重构胶水代码》" /><meta name="author" content="Jason.wu" /><meta property="og:locale" content="zh" /><meta name="description" content="Jason.wu’s Technology Blog." /><meta property="og:description" content="Jason.wu’s Technology Blog." /><link rel="canonical" href="https://github.com/ai-56cx/ai-56cx.github.io/posts/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AE%9E%E8%B7%B5_03/" /><meta property="og:url" content="https://github.com/ai-56cx/ai-56cx.github.io/posts/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AE%9E%E8%B7%B5_03/" /><meta property="og:site_name" content="Jason.wu" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-08-25T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="📃文章案例实践及剖析：《高德信息业务DDD实战 - 聊聊用领域重构胶水代码》" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jason.wu","url":"https://github.com/ai-56cx/"},"dateModified":"2019-08-25T00:00:00+08:00","datePublished":"2019-08-25T00:00:00+08:00","description":"Jason.wu’s Technology Blog.","headline":"📃文章案例实践及剖析：《高德信息业务DDD实战 - 聊聊用领域重构胶水代码》","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/ai-56cx/ai-56cx.github.io/posts/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AE%9E%E8%B7%B5_03/"},"url":"https://github.com/ai-56cx/ai-56cx.github.io/posts/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AE%9E%E8%B7%B5_03/"}</script><title>📃文章案例实践及剖析：《高德信息业务DDD实战 - 聊聊用领域重构胶水代码》 | Jason.wu</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Jason.wu"><meta name="application-name" content="Jason.wu"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/img/favicons/avatar.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">Jason.wu</a></div><div class="site-subtitle fst-italic">Life and Technology, Life Priority.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>关于</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://gitee.com/ai-56cx/" aria-label="gitee" target="_blank" rel="noopener noreferrer" > <i class="fa-solid fa-laptop-code"></i> </a> <a href="https://github.com/ai-56cx" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['ai-56cx','outlook.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>📃文章案例实践及剖析：《高德信息业务DDD实战 - 聊聊用领域重构胶水代码》</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..." > </span> <span id="search-cancel">取消</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>📃文章案例实践及剖析：《高德信息业务DDD实战 - 聊聊用领域重构胶水代码》</h1><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1566662400" data-df="YYYY/MM/DD" data-bs-toggle="tooltip" data-bs-placement="bottom" > 2019/08/25 </em> </span><div class="d-flex justify-content-between"> <span> 作者 <em> <a href="https://github.com/ai-56cx/">Jason.wu</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="5398 字" > <em>29 分钟</em>阅读</span></div></div></div><div class="post-content"><h2 id="1️⃣-导读"><span class="me-2">1️⃣ 导读</span><a href="#1️⃣-导读" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><blockquote><p><a href="https://mp.weixin.qq.com/s/ekQwTWg_WMgWMMjqKnqcIg" target="_blank">《高德信息业务DDD实战 - 聊聊用领域重构胶水代码》</a>：来源于微信公众号《阿里云开发者》</p></blockquote><h2 id="2️⃣-内容"><span class="me-2">2️⃣ 内容</span><a href="#2️⃣-内容" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>导读：本文主要记录了高德信息业务DDD实战中如何用领域重构胶水代码。</p><h3 id="一背景"><span class="me-2">一、背景</span><a href="#一背景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>团队简介：高德信息业务us团队主要承接聚合下游服务（搜索、推荐、广告、离线、商服、营销等）面向端、车机等上游，持续、稳定的提供多行业、多品类、多场景的结构化数据服务。</p></blockquote><p><a href="/assets/article/202307/20230727高德信息业务DDD实战01.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战01.png" alt="高德信息业务us团队业务背景" class="lazyload" data-proofer-ignore></a> <em>高德信息业务us团队业务背景</em></p><p>目前高德信息业务门户有 美食、酒店、旅游、休娱、房产、商超、火客飞、周边游等行业或场景的portal页。由于每个业务的发展周期和节奏大不相同，每个细分行业下portal页的维护迭代不论是从产品、开发都是隔离的，自身团队的定位在没有严格统一的把控下比较容易产生胶水代码。这个现状对于信息业务的大目标-支撑好359行 来说是尤其困难的。</p><p><a href="/assets/article/202307/20230727高德信息业务DDD实战02.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战02.png" alt="行业下各个业务线的产品、开发" class="lazyload" data-proofer-ignore></a> <em>行业下各个业务线的产品、开发</em></p><p>这种隔离方式导致各业务之间存在信息茧房，也就是面条式的产品逻辑和代码，唯一的交集是代码库，各组开发同学在没有portal页顶层设计输入的情况下，难有业务全局观，不同portal页各自开发，相同模块在没有统一设计和管理的情况下面临两种问题：</p><ul><li>方案链路不一致，多种链路交替，各自维护；<li>存在重复逻辑，散落在不同应用中，代码各自为战，重复实现；</ul><p>在方案不统一、重复建设的情况下，us的portal面临着更长期的问题：</p><ul><li>系统设计的质量不高，故障率和风险加大<li>开发维护成本大致随着portal页的数量线性增长<li>无知识管理、团队之间协作困难，容易产生信息孤岛和理解不一致<li>容易产生系统之间边界不清晰，加大维护成本</ul><h3 id="二目标"><span class="me-2">二、目标</span><a href="#二目标" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>通过统一的、规范的、合理的系统设计做到增强复用、降本提效，提高稳定性</p><ul><li>对明确的固定场景，有统一的、稳定的实现方案<li>提高设计质量和可维护性，降低故障率和风险<li>减少重复工作，降低开发维护成本<li>提高知识管理，促进团队协作，避免信息孤岛和误解<li>使不同团队、系统之间的边界清晰，减少内耗</ul><p>要达到这个目标，首先要找到业务持续演进的过程中，哪些是经常变的，哪些是相对稳定的。</p><p><a href="/assets/article/202307/20230727高德信息业务DDD实战03.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战03.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><p>结合信息业务的实际情况，不难发现行业是一个可变的因素，但是场景相对来说比较固定，也就是说同样一个场景，需要同时支撑多个行业，每个行业在同一时间点，会有行业专属的发展状态、定制逻辑。</p><p><a href="/assets/article/202307/20230727高德信息业务DDD实战04.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战04.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><p>当场景相对固定后，面对相同的场景，业务系统更期待的是相对稳定、统一的技术方案和链路。举个例子：portal的金刚位，业务站在金刚位自身去考虑，应该主要包括运营配置、算法推荐、广告植入这些重要功能，并且将这些特性和功能提供给每个产品或运营负责的行业阵地中去，当某个行业需要该组件新的特性时，可以统一考虑设计，从而可以将该功能延展到其他行业使用。同时当流程和链路统一后，协议也就很容易做到了通用和一致。</p><p><a href="/assets/article/202307/20230727高德信息业务DDD实战05.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战05.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><p>多行业多形态的业务迭代下，产品的设计基于行业，能力的沉淀考虑不同行业间的共性和差异，进而做到不同场景的复用。业务创新、能力沉淀、场景复用可以形成有效紧密的闭环。</p><h3 id="三设计"><span class="me-2">三、设计</span><a href="#三设计" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="0什么是gbf"><span class="me-2">0、什么是GBF</span><a href="#0什么是gbf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GBF（Gaode Business Framework）是高德信息业务提供的一套用于业务身份+场景策略的一套业务框架，框架自身借鉴了TMF的理念，结合领域建设（DDD）的思想，为产品业务和技术开发之间提供一套完善的、高效的、跨行业、多场景的轻量级框架。</p><h4 id="1为什么要用gbf"><span class="me-2">1、为什么要用GBF</span><a href="#1为什么要用gbf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>GBF使用了领域的概念：在研究某个问题时，将复杂问题划分为若干个相互独立的子问题，以便更好地组织、分析和解决问题。领域划分的作用在US的体现主要有以下几点：</p><ul><li>提高问题分析的精度：使用划定好的领域，能够快速的将需求点定位到某个具体的问题域，从而将某一类问题归类管理，简化复杂性的同时也能够让领域内部的逻辑能更聚焦<li>促进知识共享和演进：使用领域构建系统后，某个具体的领域交给专人维护，培养领域专家，做好领域模型表达促进技术和产品之间的交流和合作，促进知识共享，高效支持业务分析。<li>提高复用性，降低开发成本：可以将相似的功能模块归为同一领域，使得不同业务能力可以共享同一领域的逻辑，提高代码的复用性。不同的开发小组可以同时并行开发各自的领域，避免小组之间的冲突和耦合问题，提高开发效率<li>提高稳定性：划分领域可以将系统分解成多个部分，使得每个部分的功能更加独立，发生问题时不会对整个系统产生影响，提高整体的稳定性。</ul><p>拿个具体的例子来看：各行业portal页的金刚位。目前us的portal页金刚位不同场景、行业均有不同的实现方式，如果涉及到不同应用相似逻辑容易有cv代码的情况</p><ul><li>景区、周边游之前配置在了diamond，后来切到了bff-other（一个提供轻量逻辑的服务，包含运营配置）<li>休娱portal页取的merger-sp（一个引擎代理，屏蔽不同引擎间的差异）<li>房产portal取的house-sp（另一个商品搜索引擎）<li>其他场景例如附近页取的bast（一个推荐引擎），结合diamond配置有干预逻辑</ul><p>通过现状我们看到每个行业或场景的金刚位实现方案都是不一样的，不同的小组开发、不同的链路方案，意味着迭代维护成本居高不下，虽然目前的新方案在一个应用中统一对金刚位进行了收拢，但是只对输出进行了统一，底层的逻辑差异还在，且不同逻辑的实现无统一标准管理，不方便复用。</p><p>基于领域的系统建设，金刚位是一个具体的问题，适合放在一个地方解决实现。也正是基于领域建设这个抓手，将金刚位这个功能点统一组织、分析，拆解金刚位需要提供哪些能力，进而逻辑分类、链路归一，然后沉淀出金刚位统一的标准链路方案。</p><p><a href="/assets/article/202307/20230727高德信息业务DDD实战06.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战06.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><p>链路方案归一后，就可以统一输入和输出</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>bizId         身份id，代表不同行业（hotel、scenic、house、unkonw）。
scenario    场景id，例如 portal（落地页）、nearyby(附近页)、search(搜索)。
// 位置参数：依据推荐位id选择提供必要位置参数
user_loc    用户定位（坐标信息）
geoobj      图面信息（x1,y1;x2,y2)portal页场景一般不会有这个参数。
cityAdcode  城市code
// 透传公参
diu、adiu、uid、gsid、csid、usid、div、superid、stepid、tid 、testid 
ajxVersion    版控
traceAppId    应用id
tracePageId   页面id
traceModuleId 模块id
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://"</span><span class="p">,</span><span class="w"> </span><span class="err">//icon地址</span><span class="w">
                </span><span class="nl">"icon_height"</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w">
                </span><span class="nl">"icon_width"</span><span class="p">:</span><span class="w"> </span><span class="mi">56</span><span class="p">,</span><span class="w">
                </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"海洋馆"</span><span class="p">,</span><span class="w"> </span><span class="err">//展示标题文案</span><span class="w">
                </span><span class="nl">"tool_tips"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9.9元"</span><span class="p">,</span><span class="w"> </span><span class="err">//icon右上角的气泡</span><span class="w">
                </span><span class="nl">"log_info"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="err">//上报埋点信息，需要算法产生的无业务语义只用来统计指标的埋点在这里存放，如果业务字段中已存在的这里不再冗余</span><span class="w">
                </span><span class="nl">"schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri://"</span><span class="w"> </span><span class="err">//跳转schema</span><span class="w"> </span><span class="err">uri://path?city=$</span><span class="p">{</span><span class="err">adcode</span><span class="p">}</span><span class="err">&amp;lat=$</span><span class="p">{</span><span class="err">y</span><span class="p">}</span><span class="err">&amp;lon=$</span><span class="p">{</span><span class="err">x</span><span class="p">}</span><span class="w"> </span><span class="err">入参us传，querysug替换占位符生成schema</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>至此我们看到了us对金刚位的实现包括统一的链路、输入输出、逻辑管理，接近理想态的实现，无论是从复用性、开发成本、需求方案对接成本能够有明显的提升，稳定性建设也可针对某一具体的领域或功能点开展。</p><h4 id="2使用gbf概念设计"><span class="me-2">2、使用GBF概念设计</span><a href="#2使用gbf概念设计" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>下面我们来看下，基于GBF的领域驱动设计理念去支撑业务开发，需要有哪些步骤</p><h5 id="21全局领域划分"><span class="me-2">2.1、全局领域划分</span><a href="#21全局领域划分" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><a href="/assets/article/202307/20230727高德信息业务DDD实战07.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战07.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><p>目前在各个域内的逻辑相对复杂度不高，为避免过度设计，按照指导原则进行聚合设计出来8个领域，支持在后续领域复杂度提升支持进行域的拆分。领域建设的指导原则大致分下面几类：</p><h6 id="211用例分析中出现的业务实体业务规则可以进入域模型的候选集">2.1.1、用例分析中出现的业务实体、业务规则可以进入域模型的候选集；</h6><p>用例分析中出现的一个或者多个对象，可以进入域模型的候选集。对应种类：业务实体、业务规则；</p><p>正例：运营规则描述了在商品、内容上的加工与干预逻辑，可以作为分域的参考实体。对照可参考淘系的限购域；</p><p>反例：搜索、推广对应的实体为doc，业务应用体现在商品、poi的id列表及标签。doc实体自身没有业务属性，属于系统内功能实现层的模型。引擎召回的标签属性归属于poi或者商品主体，故doc不能作为域模型的参考实体；</p><h6 id="212领域建立的前提条件是明确稳定的实体与稳定的行为">2.1.2、领域建立的前提条件是明确稳定的实体与稳定的行为；</h6><p>反例：面向场景、行业设计领域，由于场景、行业的不可枚举（发散、不收敛），会导致域的不稳定。比如酒店域、旅游域；</p><h6 id="213如果多个实体间是归属关系需要合并成同一个域">2.1.3、如果多个实体间是归属关系，需要合并成同一个域；</h6><p>归属关系定义：在没有父实体存在的前提下，子实体无明确业务语义。</p><p>正例：营销时有活动规则、优惠规则，运营时有干预规则。脱离营销活动、运营的限定下，规则自身没有明确的业务语义。规则需要分别归属至对应的父实体；</p><h6 id="214如果多个实体间为引用关系则各自成域">2.1.4、如果多个实体间为引用关系则各自成域；</h6><p>引用关系定义：多个实体同时在多个用例中出现。任意实体的业务语义不依赖其他实体的补充。</p><p>正例：商铺会挂接在poi上，在大部分业务场景下会同时出现。挂接关系属于引用关系的一种；</p><p>反例：参见归属关系正例；</p><h6 id="215分域时需要参考组织结构关系">2.1.5、分域时需要参考组织结构关系；</h6><p>优惠和活动是否合为一个域？是。业务行为逻辑耦合度较高，例如：秒杀活动使用优惠券的方式支持。同时在信息工程视角，优惠与活动都属于营销中心；</p><h5 id="22统一领域建设"><span class="me-2">2.2、统一领域建设</span><a href="#22统一领域建设" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><a href="/assets/article/202307/20230727高德信息业务DDD实战08.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战08.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><p>团队以前抽象和复用的角度主要关注点在链路上，缺少领域的管理，容易导致当链路发生变化时，各领域间的调用和依赖关系发生调整，协议也容易发生变化（系统模块间解耦不够清晰），不同应用之间出现逻辑相似度高但无法复用的代码。拿POI卡这个例子看，当抽象管理的维度添加领域对象后，可以归纳出如上图的结构关系，借此可以明确各领域的数据结构表达和管理规范每个领域之间的行为。当POI的核心领域和业务领域明确后，标准业务能力层的Process可以直接引用，两者之间只剩下引用关系，不再有任何的复杂加工逻辑。Process对应着不同的场景，自此POI的领域模型和方法对标准能力和场景解耦。</p><h5 id="23系统分层标准输入输出"><span class="me-2">2.3、系统分层，标准输入输出</span><a href="#23系统分层标准输入输出" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p>gbf应用分层</p><p><a href="/assets/article/202307/20230727高德信息业务DDD实战09.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战09.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><p>gbf对象分层</p><p><a href="/assets/article/202307/20230727高德信息业务DDD实战10.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战10.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><h5 id="24接口行为统一差异定制实现"><span class="me-2">2.4、接口行为统一，差异定制实现</span><a href="#24接口行为统一差异定制实现" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><a href="/assets/article/202307/20230727高德信息业务DDD实战11.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战11.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><h5 id="25portal整体架构"><span class="me-2">2.5、portal整体架构</span><a href="#25portal整体架构" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><h6 id="251结构">2.5.1、结构</h6><p><a href="/assets/article/202307/20230727高德信息业务DDD实战12.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战12.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><h6 id="252流程">2.5.2、流程</h6><p><a href="/assets/article/202307/20230727高德信息业务DDD实战13.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战13.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><h4 id="3使用gbf开发"><span class="me-2">3、使用GBF开发</span><a href="#3使用gbf开发" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>使用GBF实现一个简单逻辑，以us的金刚位调用querysug下游为例</p><p>1、在repository包里定义fetcher的输入reqParam、输出 PO，在repo impl中创建声明式fetcher</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@FetcherClient</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"sug-fetcher"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SugFetcher</span> <span class="o">{</span>
    <span class="nd">@FetcherMethod</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"quicklink"</span><span class="o">)</span>
    <span class="nc">QuerySugResult</span><span class="o">&lt;</span><span class="nc">QuickLinkPO</span><span class="o">&gt;</span> <span class="nf">getQuickLink</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="nc">QuickLinkReqParam</span> <span class="n">reqParam</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>对接口服务的调用使用声明的方式编写代码，能够直观表达接口参数和协议的同时还可以借助业脉平台方便的批量导出文档。</p><p>2、在repository中定义repo接口，在impl中定义实现</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">QuickLinkRepo</span> <span class="o">{</span>
    <span class="nd">@Annotation</span><span class="o">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"获取金刚位"</span><span class="o">)</span>
    <span class="nc">QuickLinkPO</span> <span class="nf">getQuickLink</span><span class="o">(</span><span class="nc">QuickLinkReqParam</span> <span class="n">reqParam</span><span class="o">);</span>
<span class="o">}</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QuickLinkRepoImpl</span> <span class="kd">implements</span> <span class="nc">QuickLinkRepo</span> <span class="o">{</span>
    <span class="nd">@Resource</span>
    <span class="nc">SugFetcher</span> <span class="n">sugFetcher</span><span class="o">;</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">QuickLinkPO</span> <span class="nf">getQuickLink</span><span class="o">(</span><span class="nc">QuickLinkReqParam</span> <span class="n">reqParam</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">sugFetcher</span><span class="o">.</span><span class="na">getQuickLink</span><span class="o">(</span><span class="n">reqParam</span><span class="o">))</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">QuerySugResult:</span><span class="o">:</span><span class="n">getData</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>多这一层的目的是为了简单处理fetcher返回的结果，例如poi的merge逻辑、特殊情况下对fetcher实现缓存等操作。</p><p>3、定义金刚位的DO和入参（这里入参没有特殊参数直接使用了基类），定义金刚位的DomainService接口，和对应的实现类。</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nd">@DomainService</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"运营领域金刚位服务"</span><span class="o">,</span> <span class="n">domain</span> <span class="o">=</span> <span class="nc">OperationDomain</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IQuickLinkDomainService</span> <span class="o">{</span>
    <span class="nc">QuickLinkDO</span> <span class="nf">getQuickLink</span><span class="o">(</span><span class="nc">BaseRequest</span> <span class="n">baseRequest</span><span class="o">);</span>
<span class="o">}</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QuickLinkDomainService</span> <span class="kd">implements</span> <span class="nc">IQuickLinkDomainService</span> <span class="o">{</span>
    <span class="nd">@Resource</span>
    <span class="nc">QuickLinkRepo</span> <span class="nc">QuickLinkRepo</span><span class="o">;</span>
    <span class="nd">@Resource</span>
    <span class="nc">IQuickLinkAbility</span> <span class="n">quickLinkAbility</span><span class="o">;</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">QuickLinkDO</span> <span class="nf">getQuickLink</span><span class="o">(</span><span class="nc">BaseRequest</span> <span class="n">baseRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//构建请求参数</span>
        <span class="kd">final</span> <span class="nc">QuickLinkReqParam</span> <span class="n">quickLinkReqParam</span> <span class="o">=</span> <span class="n">quickLinkAbility</span><span class="o">.</span><span class="na">buildQueryParam</span><span class="o">(</span><span class="n">baseRequest</span><span class="o">);</span>
        <span class="c1">//请求金刚位服务</span>
        <span class="kd">final</span> <span class="nc">QuickLinkPO</span> <span class="n">quickLinkPO</span> <span class="o">=</span> <span class="n">quickLinkRepo</span><span class="o">.</span><span class="na">getQuickLink</span><span class="o">(</span><span class="n">quickLinkReqParam</span><span class="o">);</span>
        <span class="c1">//根据返回结果构建金刚位DO（标准DO）可作为DTO输出</span>
        <span class="kd">final</span> <span class="n">quickLinkDO</span> <span class="n">quickLinkDO</span> <span class="o">=</span> <span class="n">quickLinkAbility</span><span class="o">.</span><span class="na">buildQuickLinkDO</span><span class="o">(</span><span class="n">quickLinkPO</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">quickLinkDO</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>抽象领域方法内的行为，生成金刚位的三部曲：构建请求参数、请求金刚位服务、构建金刚位DO返回结果。</p><p>这块是需要注意的地方，为什么要做接口的抽象？因为要做行为的管理，行为管理的意义分多个方面去看：一方面在于统一输入输出，将流程的代码逻辑放到实现类里，DomainService里的领域方法就可以比较清晰的表达出来；</p><p>另一方面接口抽象后就可以有不同的实现方式，这就和设计模式里的策略模式一样，GBF使用了bizId(业务身份，代表行业) scenario（场景id）作为策略的key，对应不同的行业就可以有不同的实现类，从而做到实现差异化的同时又能够统一输入和输出。尽管很多时候现存的差异化从长期来看没有存在的意义，作为短中期的实现这是比较理想的方案。</p><p>4、定义ability、实现action</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@DomainAbility</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"金刚位ability"</span><span class="o">,</span> <span class="n">domain</span> <span class="o">=</span> <span class="nc">OperationDomain</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IQuickLinkAbility</span> <span class="o">{</span>
    <span class="nd">@ActionExtensible</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"构建金刚位请求参数"</span><span class="o">)</span>
    <span class="nc">QuickLinkReqParam</span> <span class="nf">buildQueryParam</span><span class="o">(</span><span class="nc">BaseRequest</span> <span class="n">request</span><span class="o">);</span>
    <span class="nd">@ActionExtensible</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"构建金刚位DO"</span><span class="o">)</span>
    <span class="nc">QuickLinkDO</span> <span class="nf">buildKQuickLinkDO</span><span class="o">(</span><span class="nc">QuickLinkPO</span> <span class="n">quickLinkPO</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultQuickLinkAction</span> <span class="kd">implements</span> <span class="nc">IQuickLinkAbility</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="nd">@Action</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"构建金刚位请求参数"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">QuickLinkReqParam</span> <span class="nf">buildQueryParam</span><span class="o">(</span><span class="nc">BaseRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">QuickLinkReqParam</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="nd">@Action</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"构建金刚位DO"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">QuickLinkDO</span> <span class="nf">buildQuickLinkDO</span><span class="o">(</span><span class="nc">QuickLinkPO</span> <span class="n">quickLinkPO</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">quickLinkPO</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="nl">QuickLinkPO:</span><span class="o">:</span><span class="n">getItems</span><span class="o">)</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Collection:</span><span class="o">:</span><span class="n">stream</span><span class="o">)</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">itemStream</span> <span class="o">-&gt;</span> <span class="n">itemStream</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">po</span> <span class="o">-&gt;</span> <span class="nc">QuickLinkDO</span><span class="o">.</span><span class="na">ItemDO</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">po</span><span class="o">.</span><span class="na">getTitle</span><span class="o">())</span>
                <span class="o">.</span><span class="na">icon</span><span class="o">(</span><span class="n">po</span><span class="o">.</span><span class="na">getIcon</span><span class="o">())</span>
                <span class="o">.</span><span class="na">iconHeight</span><span class="o">(</span><span class="n">po</span><span class="o">.</span><span class="na">getIconHeight</span><span class="o">())</span>
                <span class="o">.</span><span class="na">iconWidth</span><span class="o">(</span><span class="n">po</span><span class="o">.</span><span class="na">getIconWidth</span><span class="o">())</span>
                <span class="o">.</span><span class="na">logInfo</span><span class="o">(</span><span class="n">po</span><span class="o">.</span><span class="na">getLogInfo</span><span class="o">())</span>
                <span class="o">.</span><span class="na">toolTips</span><span class="o">(</span><span class="n">po</span><span class="o">.</span><span class="na">getToolTips</span><span class="o">())</span>
                <span class="o">.</span><span class="na">schema</span><span class="o">(</span><span class="n">po</span><span class="o">.</span><span class="na">getSchema</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">()).</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">QuickLinkDO:</span><span class="o">:</span><span class="k">new</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>这一步的ability定义和上一步的domain方法是紧密相关的，ability定义后一般会有一个默认实现，如果不同场景和行业有差异（例如hotel）就需要在us-app-hotel这个工程里写对应的Action实现ability。GBF底层是通过包名的方式（com.amap.xxx.app.hotel.action）结合application.yaml的配置(biz-id映射的package)去路由到对应的Action实现，场景这块则是根据@Scenario注解来作区分，这也是GBF基于业务身份和场景做策略的实现方式。</p><p>5、实现NodeService</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@ProcessNode</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"QuickLinkService"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QuickLinkNodeService</span> <span class="kd">extends</span> <span class="nc">AbstractCommonNodeService</span><span class="o">&lt;</span><span class="nc">QuickLinkDO</span><span class="o">,</span> <span class="nc">BaseRequest</span><span class="o">&gt;{</span>
    <span class="nd">@Autowired</span>
    <span class="nc">IQuickLinkDomainService</span> <span class="n">quickLinkDomainService</span><span class="o">;</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">QuickLinkDO</span> <span class="nf">doInvoke</span><span class="o">(</span><span class="nc">BaseRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">quickLinkDomainService</span><span class="o">.</span><span class="na">getQuickLink</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Node的定位可参照GBF的相关资料，这里逻辑比较简单，也会存在逻辑复杂的场景，例如走merger链路的feed流，走营销获取活动信息盘货信息再走merger找回的运营位。</p><p>6、Process注册Node</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">//在ProcessConfig中声明Node</span>
<span class="nc">BaseNodeConfigBuilder</span> <span class="n">quickLinkNode</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NodeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">preJoinPoint</span><span class="o">(</span><span class="k">new</span> <span class="nc">JoinPoint</span><span class="o">&lt;</span><span class="nc">PortalParam</span><span class="o">,</span> <span class="nc">BaseRequest</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="nc">BaseRequest</span> <span class="nf">join</span><span class="o">(</span><span class="nc">PortalParam</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">request</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}).</span><span class="na">nodeBeanName</span><span class="o">(</span><span class="nc">BeanUtil</span><span class="o">.</span><span class="na">getBeanName</span><span class="o">(</span><span class="nc">QuickLinkNodeService</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
<span class="c1">//processConfig注册Node</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ProcessConfig</span> <span class="nf">portalProcess</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ProcessConfigBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">request</span><span class="o">(</span><span class="nc">Request</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">response</span><span class="o">(</span><span class="nc">CommonResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">nodes</span><span class="o">(</span><span class="n">userNode</span><span class="o">)</span>
            <span class="o">.</span><span class="na">nodes</span><span class="o">(</span><span class="n">filterTabNode</span><span class="o">)</span>
            <span class="o">.</span><span class="na">nodes</span><span class="o">(</span><span class="n">feedNode</span><span class="o">)</span>
            <span class="o">.</span><span class="na">nodes</span><span class="o">(</span><span class="n">bannerNode</span><span class="o">)</span>
            <span class="o">.</span><span class="na">nodes</span><span class="o">(</span><span class="n">quickLinkNode</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>7、接口注册</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/process"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcessController</span> <span class="o">{</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/portal/{biz}"</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="nc">Result</span><span class="o">&lt;</span><span class="nc">Response</span><span class="o">&gt;</span> <span class="nf">portal</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">String</span> <span class="n">biz</span><span class="o">,</span> <span class="nc">PortalParam</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">NodeService</span><span class="o">&lt;</span><span class="nc">Response</span><span class="o">,</span> <span class="nc">Request</span><span class="o">&gt;</span> <span class="n">process</span> <span class="o">=</span> <span class="nc">BeanUtil</span><span class="o">.</span><span class="na">getSpringBean</span><span class="o">(</span><span class="nc">ProcessRegister</span><span class="o">.</span><span class="na">genericBeanName</span><span class="o">(</span><span class="nc">PortalProcessConfig</span><span class="o">.</span><span class="na">BEAN_NAME</span><span class="o">));</span>
        <span class="n">param</span><span class="o">.</span><span class="na">setBizId</span><span class="o">(</span><span class="n">biz</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">process</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="nc">ProcessResult</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">"未找到流程"</span><span class="o">)</span> <span class="o">:</span> <span class="n">process</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">param</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>至此使用GBF实现一个简单完整的流程就完成了。</p><h3 id="四总结"><span class="me-2">四、总结</span><a href="#四总结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>基于领域建设的思想，使用GBF构建业务能力能够给US带来以下几点优势：</p><ul><li>帮助us沉淀各领域的业务，标准化流程链路，明确业务逻辑；<li>需求拆解后能够有对应的领域收拢，各领域间无耦合，使问题更聚焦；<li>领域沉淀的能力方法能够很好的复用，不同场景间的功能节点基于领域能力去构建，构建好的能力可以在其他场景（附近页、会场、泛搜等）直接复用，提高开发效率；<li>进一步强化能力逻辑的表达，借助业脉系统可视化流程构建专业知识库，帮助开发同学快速、直观的了解业务，进而提高技术对业务的scense，有全局观的同时又能够方便把握细节，提高产品和技术、技术和技术之间的沟通效率；<li>可针对某个领域或功能节点进行稳定性建设，减少不同功能节点之间的依赖，提高整体稳定性；</ul><p>业脉对业务流程的表达：</p><p><a href="/assets/article/202307/20230727高德信息业务DDD实战14.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战14.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><p><a href="/assets/article/202307/20230727高德信息业务DDD实战15.png" class="popup img-link "><img data-src="/assets/article/202307/20230727高德信息业务DDD实战15.png" alt="高德信息业务DDD实战" class="lazyload" data-proofer-ignore></a> <em>高德信息业务DDD实战</em></p><p>信息工程服务是结构化数据+策略的体现，在标准能力的基础上建设“主题场景能力”，不同场景、行业组成的各式各样的页面可以由进行抽象出具体的功能节点，例如 金刚位、banner、feed流、优惠、广告、营销位、评论等等，每个功能节点是不同领域之间能力的组合，同时在不同场景和行业又可以有不同的逻辑。gbf基于业务身份（行业）和场景作为路由的key，同一个接口不同实现类来支撑不同行业和场景的差异，然后在Process层对各业务功能节点进行组织编排，从而形成标准的业务能力。</p><h2 id="3️⃣-剖析"><span class="me-2">3️⃣ 剖析</span><a href="#3️⃣-剖析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/%E7%BC%96%E7%A8%8B/'>编程</a>, <a href='/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/'>软件工程</a>, <a href='/categories/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/'>领域驱动设计</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" class="post-tag no-text-decoration" >软件工程</a> <a href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1-ddd/" class="post-tag no-text-decoration" >领域驱动设计(DDD)</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted me-1">分享</span> <span class="share-icons"> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="分享链接" data-title-succeed="链接已复制！" > <i class="fa-fw fas fa-link pe-none"></i> </button> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/">📂数据库：组织和存储数据的系统</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/java%E6%A1%86%E6%9E%B6/">Java框架</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a> <a class="post-tag btn btn-outline-primary" href="/tags/java%E5%9F%BA%E7%A1%80/">Java基础</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87/">移动设备</a> <a class="post-tag btn btn-outline-primary" href="/tags/python%E5%9F%BA%E7%A1%80/">Python基础</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/">版本控制</a> <a class="post-tag btn btn-outline-primary" href="/tags/java%E6%8A%80%E5%B7%A7/">Java技巧</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/">工作流</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">Git</a> <a class="post-tag btn btn-outline-primary" href="/tags/spring%E7%94%9F%E6%80%81/">Spring生态</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">文章内容</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> 相关文章</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1566662400" data-df="YYYY/MM/DD" > 2019/08/25 </em><h4 class="pt-0 my-2" data-toc-skip>📂领域驱动设计（Domain Driven Design，缩写DDD）：软件代码的结构及语言需符合业务领域中的习惯用法</h4><div class="text-muted small"><p> 1️⃣ 导读 百度百科(DDD)      一种通过将软件实现与核心业务概念的演进紧密相连从而实现复杂需求的软件开发方法。 维基百科(领域驱动设计)      领域驱动设计（英语：domain-driven design，缩写 DDD）是软件代码的结构及语言（类别名称、类方法、类变量）需符合业务领域中的习惯用法。例如处理租赁业务的软件，其类型可以命名为LoanAppli...</p></div></div></a></div><div class="col"> <a href="/posts/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AE%9E%E8%B7%B5_01/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1566662400" data-df="YYYY/MM/DD" > 2019/08/25 </em><h4 class="pt-0 my-2" data-toc-skip>📃文章案例实践及剖析：《领域驱动设计DDD｜从入门到代码实践》</h4><div class="text-muted small"><p> 1️⃣ 导读 《领域驱动设计DDD｜从入门到代码实践》：来源于微信公众号《阿里云开发者》 2️⃣ 内容 导读：本文希望能够通过总结过去自己对领域建模的一点粗浅经验给需要的同学能有些许启发，少走弯路。 3️⃣ 剖析</p></div></div></a></div><div class="col"> <a href="/posts/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AE%9E%E8%B7%B5_02/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1566662400" data-df="YYYY/MM/DD" > 2019/08/25 </em><h4 class="pt-0 my-2" data-toc-skip>📃文章案例实践及剖析：《迄今为止最完整的DDD实践》</h4><div class="text-muted small"><p> 1️⃣ 导读 《迄今为止最完整的DDD实践》：来源于微信公众号《阿里技术》 《迄今为止最完整的DDD实践》：来源于微信公众号《阿里云开发者》 2️⃣ 内容 导读：对于一个架构师来说，在软件开发中如何降低系统复杂度是一个永恒的挑战。 一、为什么需要DDD 复杂系统设计：系统多，业务逻辑复杂，概念不清晰，有什么合适的方法帮助我们理清楚边界，逻辑和概念 多团...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AE%9E%E8%B7%B5_02/" class="btn btn-outline-primary" prompt="上一篇" ><p>📃文章案例实践及剖析：《迄今为止最完整的DDD实践》</p></a> <a href="/posts/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E8%AE%BA_01/" class="btn btn-outline-primary" prompt="下一篇" ><p>📃文章剖析：《领域建模的体系化思维与6种方法论》</p></a></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/java%E6%A1%86%E6%9E%B6/">Java框架</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a> <a class="post-tag btn btn-outline-primary" href="/tags/java%E5%9F%BA%E7%A1%80/">Java基础</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87/">移动设备</a> <a class="post-tag btn btn-outline-primary" href="/tags/python%E5%9F%BA%E7%A1%80/">Python基础</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/">版本控制</a> <a class="post-tag btn btn-outline-primary" href="/tags/java%E6%8A%80%E5%B7%A7/">Java技巧</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/">工作流</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">Git</a> <a class="post-tag btn btn-outline-primary" href="/tags/spring%E7%94%9F%E6%80%81/">Spring生态</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a></p><p>© 2023 <a href="https://github.com/ai-56cx">Jason.wu</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。" >保留部分权利。</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">发现新版本的内容。</p><button type="button" class="btn btn-primary" aria-label="Update"> 更新 </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/zh.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
